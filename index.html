<!DOCTYPE HTML>
<html>

<head>
<title>马波罗的歌</title>

<meta name="viewport" http-equiv="Content-Type" content="width=device-width; text/html; charset=utf-8"/>


<style>
#greeting {
  text-align: center;
  color: white;
  font-size: 4vh;
}

@media only screen and (orientation: landscape) {
	#greeting {
	  text-align: center;
	  color: white;
	  font-size: 5vw;
	}
}

#verse {
  text-align: center;
  font-size: 32px;
  margin-top: 0vh;
  margin-bottom: 0vh;
  margin-left: 0vw;
  margin-right: 0vw;
}
div {
  text-align: center;
  margin-top: 0.0em;
}
#player {
  text-align: center;
   position: relative;
   width: 100%;
   height: 90vh;
   padding-top: 0.0%; /* 16:9 Aspect Ratio */  
}

.dropbtn {
  background-color: #3498DB;
  color: white;
  //padding: 16px 6px 16px 6px;
  padding: 2vh 1vw 2vh 1vw;
  font-size: 4vh;
  border: none;
  cursor: pointer;
  //width: 48px;
  //transform:rotate(-90deg);
}

.dropbtn:hover, .dropbtn:focus {
  background-color: #2980B9;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: relative; //  position: absolute;
  background-color: #f1f1f1;
  min-width: 40vw;
  overflow: auto;
  //box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 2px 6px;
  text-decoration: none;
  display: block;
  text-align: left;
  font-size: 4vw;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;}

.th1 {
  text-align: left;
  //width: 1%
}
.th2 {
  text-align: center;
  width: 98%
}
}
.th3 {
  text-align: top;
  width: 2%
}
table {
  //text-align: center;
  //width: 100%;
}
body {
	background-color: black; //#1c87c9;
}


</style>
</head>

<body>

<table>
  <tr>
	<th rowspan="2"class="th2">
		<div id="greeting">马波罗教会歌选</div>
		<div class="player-container" id="player"></div> 	
	</th>
	<th class="th3">
	  <div class="dropdown">
	  <button onclick="myFunction()" class="dropbtn">歌单</button>
		  <div id="myDropdown" class="dropdown-content">
		  </div>
	  </div>	
	</th>	
  </tr>	
  <tr>
	<th class="th3">
	  <div class="dropdown">
	  <button onclick="reloadPage()" class="dropbtn">下一首</button>
	  </div>	
	</th>  
  </tr>
</table>
 
<script>

/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>

<script>
	var url = window.location.href.toString();
	var song = url.substring(url.lastIndexOf("=")+1);
	if(!song)
		console.log('song is not set');
	else {
		console.log('url=' + url);
		console.log('song=' + song);
	}
</script>
<script>
        var videos = [
		  {"videoId":"nuK3oi7-YoM","name":"你坐著為王"},	
		  {"videoId":"QIwM0MJ7qLI","name":"今生跟随主耶稣"},
		  {"videoId":"PlZOC3fdeus","name":"Hi Ne Ni 我在這裡"},
		  {"videoId":"tPf7Ig1ebL4","name":"这一生最美的祝福"},
		  {"videoId":"bhS0D7Gd-Ek","name":"我要向高山舉目"},
		  {"videoId":"nmd0bLtRqu8","name":"我知誰掌管明天"},
		  {"videoId":"fvUsgi3gxJU","name":"最知心的朋友"},
		  {"videoId":"UXdQ80sUIZM","name":"充滿我"},
		  {"videoId":"O164IvfKbLA","name":"耶稣听我的呼求"},
		  {"videoId":"VMC5Wo6CaTk","name":"野地的花"},
		  {"videoId":"-fLdDev9iqo","name":"我心屬於你"},
		  {"videoId":"5Pe2csSjlXU","name":"恩典的記號"},
		  {"videoId":"Ay1Yj84-hhU","name":"深深愛祢"},
		  {"videoId":"-kHB_L11P_U","name":"你的愛不離不棄"},
		  {"videoId":"dvtU_zoSmFM","name":"空谷的回音"},
		  {"videoId":"Q6g2g_qnCB0","name":"轻轻听 輕輕聽"},
		  {"videoId":"vVTAOvZV1HM","name":"耶穌愛你"},
		  {"videoId":"seusEUDAPK4","name":"純音樂_何等恩典"},
		  {"videoId":"Sd--GtZJ9wc","name":"哈利路亞"},
		  {"videoId":"2Y4vZn28JxY","name":"最好的福氣"},
		  {"videoId":"Tkd3D7m8YCk","name":"能不能一生愛祢"},
		  {"videoId":"Y2aXZIBg7XI","name":"主啊我能做什么"},		  
		  {"videoId":"ksANigSjZ-4","name":"雨後的天空"},
		  {"videoId":"Xins1HYD49w","name":"不能忘记"},
		  {"videoId":"P8R9_oEFgdg","name":"有一位神"},
	  ];
        
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = createPlayer(getNextVideo());
		console.log('*** onYouTubeIframeAPIReady is reaady');		
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
		console.log('*** player is reaady');
      }
      
      function createPlayer(_videoId) {
        player = new YT.Player('player', {
          //height: '570',
          //width: '940',
          videoId: _videoId,
          playerVars: {
            'playsinline': 1
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
        return player;
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      var done = false;
      function onPlayerStateChange(event) {
        //YT.PlayerState.ENDED
        //YT.PlayerState.PLAYING
        //YT.PlayerState.PAUSED
        //YT.PlayerState.BUFFERING
        //YT.PlayerState.CUED

        if (event.data == YT.PlayerState.ENDED) {
			console.log('*** player has ENDED');		
        	player.loadVideoById(getNextVideo()); //this will start playing
            player.playVideo();  //this line does not seem doing anything
        }
      }
      function stopVideo() {
        player.stopVideo();
      }
      function getNextVideo() {	
		var	songIdx = Math.floor(Math.random(new Date().getMilliseconds()) * videos.length);
		
		if(!isNaN(song))
			songIdx = song - 1; //if the querystring already specifies a video, only play that one

		//console.log('*** songIdx=' + songIdx);

      	return videos[songIdx].videoId;
      }
    </script>
	
	<script>
	var baseURL = url;
	var div = document.getElementById('myDropdown');
	if(url.indexOf('?') > 0)
		baseURL = url.substring(0,url.indexOf('?'));
		
	var newlink = document.createElement('a');
	newlink.setAttribute('href', baseURL);
	newlink.innerHTML='0 **Play Randomly**';
	div.appendChild(newlink);
		
	videos.forEach((video, index, fullArray) =>  {  
		//document.writeln(video);
		//console.log('** video=' + video.name);
		newlink = document.createElement('a');
		newlink.setAttribute('href', baseURL + '?video=' + (index+1));
		newlink.innerHTML=(index+1) + ' ' + video.name;
		div.appendChild(newlink);	  
	});
	

	function reloadPage()
	  {
	  //window.location.reload();
	  window.location.href = baseURL;
	  }
	
	</script>	
</body>
</html>
